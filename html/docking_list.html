<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>上海厚步网络科技有限公司</title><link rel="shortcut icon" type="image/ico" href="http://www.bramble.wang/back/favicon.ico"><link rel="stylesheet" href="http://www.bramble.wang/back/css/main.css" media="all"><script>void 0===document.getElementsByClassName&&(location.href="http://www.bramble.wang/back/html/not_support.html")</script><style>.opers{padding:10px 0;text-align:right;border-bottom:2px solid #A7CDD8}.docking_list{min-height:100px}.icon_test{color:#007AFF;vertical-align:top;margin:0 5px;cursor:pointer}.test_dock_idfa{margin-top:30px}</style></head><body><aside class="sidebar"><div class="top_bar"><p class="logo"><i class="iconfont icon-95b"></i></p><i class="iconfont icon-7cd toggle_another_form"></i></div><ul class="menu"><li><a href="http://www.bramble.wang/back/html/todo.html"><i class="iconfont icon-878"></i><span class="title">TODO</span><span class="arrow"></span></a></li><li><a href="javascript:;"><i class="iconfont icon-72d"></i><span class="title">UI组件</span><span class="arrow"></span></a><ul class="sub_menu"><li><a href="http://www.bramble.wang/back/html/grid.html" class="title">网格布局(grid)</a></li><li><a href="http://www.bramble.wang/back/html/button.html" class="title">按钮(button)</a></li><li><a href="http://www.bramble.wang/back/html/form_element.html" class="title">表单元素(form-element)</a></li><li><a href="http://www.bramble.wang/back/html/validate.html" class="title">验证(validate)</a></li><li><a href="http://www.bramble.wang/back/html/mask.html" class="title">遮罩(mask)</a></li><li><a href="http://www.bramble.wang/back/html/tip.html" class="title">提示(tip)</a></li><li><a href="http://www.bramble.wang/back/html/box.html" class="title">弹框(box)</a></li><li><a href="http://www.bramble.wang/back/html/icon_font.html" class="title">图标(iconfont)</a></li><li><a href="http://www.bramble.wang/back/html/expression.html" class="title">表情(expression)</a></li><li><a href="http://www.bramble.wang/back/html/datepicker.html" class="title">日期控件(datepicker)</a></li></ul></li><li><a href="javascript:;"><i class="iconfont icon-72e"></i><span class="title">项目</span><span class="arrow"></span></a><ul class="sub_menu"><li><a href="http://www.bramble.wang/back/html/spd/user.html" class="title">用户(user)</a></li><li><a href="http://www.bramble.wang/back/html/spd/guest_user.html" class="title">特邀用户(guest_user)</a></li><li><a href="http://www.bramble.wang/back/html/report/guest_user.html" class="title">特邀用户报表</a></li></ul></li><li><a href="javascript:;"><i class="iconfont icon-889"></i><span class="title">图表</span><span class="arrow"></span></a><ul class="sub_menu"><li><a href="http://www.bramble.wang/back/html/chart1.html" class="title">图表1</a></li><li><a href="http://www.bramble.wang/back/html/chart2.html" class="title">图表2</a></li></ul></li><li><a href="javascript:;"><i class="iconfont icon-862"></i><span class="title">表格</span><span class="arrow"></span></a><ul class="sub_menu"><li><a href="http://www.bramble.wang/back/html/table1.html" class="title">表格1</a></li><li><a href="http://www.bramble.wang/back/html/table2.html" class="title">表格2</a></li></ul></li><li><a href="http://www.bramble.wang/back/html/form.html"><i class="iconfont icon-85a"></i><span class="title">表单页面</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/push.html"><i class="iconfont icon-8a6"></i><span class="title">推送</span><span class="arrow"></span></a></li><li class="active"><a href="http://www.bramble.wang/back/html/docking_list.html"><i class="iconfont icon-83c"></i><span class="title">对接</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/welcome.html"><i class="iconfont icon-730"></i><span class="title">欢迎页面</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/login.html"><i class="iconfont icon-919"></i><span class="title">登录页面</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/404.html"><i class="iconfont icon-705"></i><span class="title">404</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/error.html"><i class="iconfont icon-94c"></i><span class="title">错误页面</span><span class="arrow"></span></a></li><li><a href="http://www.bramble.wang/back/html/not_support.html"><i class="iconfont icon-836"></i><span class="title">不支持页面</span><span class="arrow"></span></a></li><li><a href="javascript:;"><i class="iconfont icon-774"></i><span class="title">个人中心</span><span class="arrow"></span></a><ul class="sub_menu"><li><a href="http://www.bramble.wang/back/html/welcome.html" class="title">我的信息</a></li><li><a href="http://www.bramble.wang/back/html/welcome.html" class="title">修改密码</a></li><li><a href="http://www.bramble.wang/back/html/welcome.html" class="title">退出登录</a></li></ul></li></ul></aside><div class="content"><div class="opers"><button type="button" class="btn btn_primary add_docking">添加对接</button></div><div class="docking_list"></div></div><script src="http://www.bramble.wang/back/js/base.js"></script><script>$(function(){function sendForm(e,t){var n=e.find('[name="id"]'),i=e.serializeArray(),a=[{name:"oper_type",value:"insert"}];n.length&&(a[0].value="update",a.push({name:"id",value:n.val()})),$.ajax({type:"POST",url:operUrl,dataType:"json",data:a.concat(i)}).done(function(e){if(1==e.status){var t=!0,a=n.val();a?t=!1:a=e.id,updateData(i,a,t)}else $(".opers").operTip(e.msg||"操作出现异常！",{theme:"danger"})}).fail(function(){$(".opers").operTip("添加失败！",{theme:"danger",css:{"white-space":"nowrap"}})}).always(function(){t.hide()})}function paddingData(e){e.source_name=getSourceName(e.source)||"关联来源失败("+(e.source||"")+")",e.unique_url=(e.unique_req_url||"无")+relateParam(e.unique_param_key,e.unique_param_val),e.click_url=(e.click_req_url||"无")+relateParam(e.click_param_key,e.click_param_val),e.active_url=(e.active_req_url||"无")+relateParam(e.active_param_key,e.active_param_val)}function updateData(form_cnt,id,isAdd){if(void 0===id)$(".opers").operTip("操作异常！",{theme:"danger",css:{"white-space":"nowrap"}});else{var new_item={id:id};$.each(form_cnt,function(i,item){var _key=item.name,_val=item.value;if(~_key.indexOf("_param_key[")||~_key.indexOf("_param_val[")){var _k='new_item["'+_key.slice(0,_key.indexOf("["))+'"]';eval("!"+_k+" ? ("+_k+'=["'+_val+'"]) : '+_k+'.push("'+_val+'")')}else new_item[_key]=_val}),paddingData(new_item),isAdd?table.data.push(new_item):$.each(table.data,function(e,t){return t.id==id?(table.data[e]=new_item,!1):void 0}),table.renderData(),$(".opers").operTip("操作成功！",{theme:"success",css:{"white-space":"nowrap"}})}}function relateParam(e,t){var n="";return e&&e.length&&$.each(e,function(e,i){if(""===i)return!0;var a=t[e];getSysOptName(a)&&(a="{"+a+"}"),n+="&"+i+"="+a}),n=n.length>1?"?"+n.slice(1):""}function getSourceName(e){var t;return $.each(source_datas,function(n,i){return i.id===e?(t=i.name,!1):void 0}),t}function remove_docking_item(e,t){$.ajax({type:"POST",url:operUrl,dataType:"json",data:{oper_type:"delete",id:e}}).done(function(e){e&&1===e.status?$(".table_filter").operTip("删除成功！",{dir:"bottom",theme:"success",timeout:5e3,css:{"white-space":"nowrap"}}):$(".table_filter").operTip(e&&e.msg||"删除响应异常",{dir:"bottom",theme:"danger",timeout:5e3,css:{"white-space":"nowrap"}})}).fail(function(){$td.operTip("删除失败！",{dir:"bottom",theme:"danger",timeout:5e3,css:{"white-space":"nowrap"}})}).always(function(){t&&t(),sourceMask.hide()})}function trigger_plus(e,t){if(t)for(var n=0;t>n;n++)e.trigger("click")}function renderForm(e){base.renderOption($("#source"),source_datas,["id","name"]);var t;$.each(table.data,function(n,i){return i.id==e?(t=i,!1):void 0}),base.requireChild($(".docking_edit")),trigger_plus($(".unique_docking_content .icon_plus"),t.unique_param_key&&t.unique_param_key.length),trigger_plus($(".click_docking_content .icon_plus"),t.click_param_key&&t.click_param_key.length),trigger_plus($(".active_docking_content .icon_plus"),t.active_param_key&&t.active_param_key.length),$('[name][type="checkbox"]',$(".docking_edit")).prop("checked",!1).trigger("change"),base.renderForm($(".docking_edit"),t,function(e){"unique_md5_val"===e&&void 0!==t[e]?$('[data-show=".unique_md5_content"]').prop("checked",!0).trigger("change"):"click_md5_val"===e&&void 0!==t[e]?$('[data-show=".click_md5_content"]').prop("checked",!0).trigger("change"):"active_md5_val"===e&&void 0!==t[e]&&$('[data-show=".active_md5_content"]').prop("checked",!0).trigger("change")},function(e,t,n){~$.inArray(n,["unique_param_val","click_param_val","active_param_val"])&&(getSysOptName(t)?$('input[name="'+n+"["+e+']"]').val(""):($('[name="'+n+"["+e+']"]').closest(".param_item").find("select").eq(0).val("preset").trigger("change"),$('select[name="'+n+"["+e+']"]').val("idfa")))})}function renderUrl(e){var t=$('[name$="_req_url"]',e),n=$('[name*="_param_key"]',e).map(function(){return $(this).val()}),i=$('[name*="_param_val"]:not(:disabled)',e).map(function(){return $(this).val()});$(".url_all",e).html(t.val()+relateParam(n,i))}function getSysOptName(e){var t;return $.each(systemOpts,function(n,i){return i.key===e?(t=i.val,!1):void 0}),t}function testDocking(e,t,n){var i={module:"test_interface",id:e,action:t};"unique"!==t?sendTestDocking(i,n):(box_idfa.sendData=i,box_idfa.$td=n,box_idfa.show())}function sendTestDocking(e,t){var n=new Mask({$ct:t,content:"接口测试中！"});$.ajax({url:operUrl,dataType:"json",data:e}).done(function(e){console.dir(e),e&&1===e.status?t.operTip("成功",{dir:"bottom",theme:"success",timeout:5e3}):t.operTip(e&&e.msg||"返回数据异常",{dir:"bottom",theme:"danger",timeout:5e3})}).fail(function(){t.operTip("获取来源信息失败",{dir:"bottom",theme:"danger",timeout:5e3})}).always(function(){n.hide()})}var operUrl="http://es1.laizhuan.com/module/interface/index.php",systemOpts=[{key:"idfa",val:"IDFA"},{key:"appid",val:"AppID"},{key:"ip",val:"IP"},{key:"dver",val:"设备版本"},{key:"time",val:"时间戳"},{key:"md5",val:"MD5"},{key:"callback",val:"回调"}],sourceMask=new Mask({$ct:$(".content"),content:"来源数据加载中！"}),source_datas=[];$.ajax({async:!1,url:operUrl,dataType:"json",data:{module:"query_source"}}).done(function(e){e&&1===e.status?source_datas=e.data:$(".opers").operTip(e&&e.msg||"来源数据异常",{dir:"bottom",theme:"danger",timeout:5e3,css:{"white-space":"nowrap"}})}).fail(function(){$(".opers").operTip("获取来源信息失败",{dir:"bottom",theme:"danger",timeout:5e3,css:{"white-space":"nowrap"}})}).always(function(){sourceMask.hide()});var opt={$ct:$(".docking_list"),col:[{key:"id",title:"ID",show:!1},{key:"app_id",title:"APP ID",sort:!0,filter:!0},{key:"app_name",title:"名称",sort:!0,filter:!0},{key:"source_name",title:"来源",sort:!0,filter:!0},{key:"unique_url",title:"排重接口",sort:!0,cls:"hidden_xs",filter:!0,render:function(e,t,n,i){var a=i.unique_req_url?'<i class="iconfont icon-8a4 icon_test" data-type="unique"></i>':"";$(e).html(t+a)}},{key:"click_url",title:"点击上报",sort:!0,cls:"hidden_xs",filter:!0,render:function(e,t,n,i){var a=i.click_req_url?'<i class="iconfont icon-8a4 icon_test" data-type="click"></i>':"";$(e).html(t+a)}},{key:"active_url",title:"激活上报",sort:!0,cls:"hidden_xs",filter:!0,render:function(e,t,n,i){var a=i.active_req_url?'<i class="iconfont icon-8a4 icon_test" data-type="active"></i>':"";$(e).html(t+a)}},{key:"id",title:"操作",cls:"text_center",render:function(e,t,n,i){$(n).data("data-obj",i);var a=$('<div class="table_btns"><button class="btn btn_info btn_search" type="button">查看</button><button class="btn btn_primary btn_renew" type="button">续单</button></div><div class="table_btns"><button class="btn btn_warning btn_edit" type="button">修改</button><button class="btn btn_danger btn_remove" type="button">删除</button></div>');$(e).html(a)}}],isLocal:!0,url:operUrl,fnAfterData:function(e){return e&&e.data&&e.data.length?void $.each(e.data,function(e,t){paddingData(t)}):!1}},table=new Table(opt),box_docking=new Box({title:"接口",html:"http://www.bramble.wang/back/html/temp/docking_form.html .docking_form",fnSure:function(e){var t=$(".docking_edit");if(t.is(".readonly"))e.hide();else{if(!base.formValidate(t))return!1;sendForm(t,e)}return!1},fnCancel:function(e){},css:{"min-width":"300px"}}),box_idfa=new Box({title:"idfa",html:'<input type="text" class="test_dock_idfa">',fnSure:function(e){e.sendData.idfa=e.$el.find(".test_dock_idfa").val(),sendTestDocking(e.sendData,e.$td)},fnCancel:function(e){},css:{"min-width":"300px"}});$(".content").on("click",".btn_remove",function(){var e=$(this).closest("tr").data("data-obj").id;new Tip({$ct:$(this).closest("td"),content:"确认删除？",confirm:!0,css:{"white-space":"nowrap"},theme:"warning",dir:"left",alertfn:function(t){t&&remove_docking_item(e,function(){table.data=$.grep(table.data,function(t){return t.id!==e}),table.renderData()})}})}).on("click",".btn_edit",function(){var e=$(this).closest("tr").data("data-obj").id;box_docking.initHeader("修改接口"),box_docking.initContent("http://www.bramble.wang/back/html/temp/docking_form.html .docking_form",function(){renderForm(e),$(".docking_edit").prepend($('<input name="id" type="hidden" value="'+e+'">')),box_docking.show()})}).on("click",".btn_renew",function(){var e=$(this).closest("tr").data("data-obj").id;box_docking.initHeader("续单接口"),box_docking.initContent("http://www.bramble.wang/back/html/temp/docking_form.html .docking_form",function(){renderForm(e),box_docking.show()})}).on("click",".btn_search",function(){var e=$(this).closest("tr").data("data-obj").id;box_docking.initHeader("查看详情"),box_docking.initContent("http://www.bramble.wang/back/html/temp/docking_form.html .docking_form",function(){renderForm(e),$(".docking_edit").addClass("readonly"),$(".docking_edit :input").prop("disabled",!0),box_docking.show()})}).on("click",".add_docking",function(){box_docking.initHeader("添加接口"),box_docking.initContent("http://www.bramble.wang/back/html/temp/docking_form.html .docking_form",function(){base.renderOption($("#source"),source_datas,["id","name"]),base.requireChild($(".docking_edit")),$(".icon_plus").trigger("click","insert"),box_docking.show()})}).on("click",".icon_test",function(){var e=$(this).closest("tr").data("data-obj"),t=$(this).attr("data-type");testDocking(e.id,t,$(this).closest("td"))}),$("body").on("click",".docking_content .icon_plus",function(e,t){var n,i=$(this).closest(".docking_content");i.is(".unique_docking_content")?n="unique":i.is(".click_docking_content")?n="click":i.is(".active_docking_content")&&(n="active");var a=$(this).data("data-index")||0,o=0===a&&"unique"!==n&&"insert"===t?" disabled ":" ",c=$('<li class="param_item"><div class="grid"><div class="ct_5-2 grid_nowrap"><div class="ct_3 field field_first">参数</div><div class="ct_3-2"><select'+o+'><option value="system" data-show="#'+n+"_system_val_"+a+'">系统值</option><option value="preset" data-show="#'+n+"_preset_val_"+a+'">预设值</option></select></div></div><div class="ct_5-3 grid"><div class="ct_2 grid_nowrap"><div class="ct_3 field">key</div><div class="ct_3-2"><input type="text"'+o+'id="'+n+"_param_key["+a+']" name="'+n+"_param_key["+a+']"></div></div><div class="ct_2 grid_nowrap"><div class="ct_3 field">value</div><div class="ct_3-2"><select id="'+n+"_system_val_"+a+'" name="'+n+"_param_val["+a+']"'+o+'></select><input type="text" disabled class="hidden" id="'+n+"_preset_val_"+a+'" name="'+n+"_param_val["+a+']"></div></div></div><i class="iconfont icon-66d icon_remove"></i></div></li>');$(this).closest(".docking_content").find(".param_items").append(c),base.renderOption($("#"+n+"_system_val_"+a),systemOpts),$(this).data("data-index",++a),base.requireChild(c)}).on("click",".docking_content .icon_remove",function(){var e=this;new Tip({$ct:$(this),content:"确认删除？",confirm:!0,css:{"white-space":"nowrap"},theme:"warning",dir:"left",alertfn:function(t){if(t){var n=$(e).closest(".docking_content");$(e).closest(".param_item").remove(),renderUrl(n)}}})}).on("change",".docking_content select",function(){renderUrl($(this).closest(".docking_content"))}).on("keyup",".docking_content input",function(){renderUrl($(this).closest(".docking_content"))})})</script></body></html>